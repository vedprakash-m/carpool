#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit validation..."

# SECURITY: Check for secrets first
echo "ğŸ”’ Checking for secrets with gitleaks..."
if command -v gitleaks &> /dev/null; then
    if ! gitleaks protect --staged --verbose; then
        echo "âŒ SECRETS DETECTED! Commit blocked."
        echo "â„¹ï¸  Remove secrets and use environment variables instead"
        echo "â„¹ï¸  To bypass (not recommended): git commit --no-verify"
        exit 1
    fi
    echo "âœ… No secrets detected"
else
    echo "âš ï¸  gitleaks not found - install with: brew install gitleaks"
fi

# Quick lint and type check only for pre-commit
echo "ğŸš€ Running fast pre-commit checks..."
./scripts/pre-commit-fast.sh || {
    echo "âŒ Pre-commit validation failed"
    exit 1
}

echo "âœ… Pre-commit validation passed!"
